<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CRLMOM</title>
    <style>
        body {
            background: #fff;
            color: #222;
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        h1 {
            margin: 12px 0;
        }

        .tabs {
            display: flex;
            justify-content: center;
            background: #eee;
            border-bottom: 2px solid #ccc;
        }

        .tabs button {
            flex: 1;
            padding: 10px;
            border: none;
            background: #eee;
            cursor: pointer;
            font-size: 1rem;
        }

        .tabs button.active {
            background: #ddd;
            font-weight: bold;
            border-bottom: 2px solid #c2d4ff;
        }

        .tab-content {
            display: none;
            padding: 18px;
        }

        .card {
            background: #f6f6f6;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 12px auto;
            max-width: 700px;
        }

        button {
            background: #c2d4ff;
            border: none;
            color: #fff;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            margin: 2px;
        }

        .row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            margin: 6px 0;
        }

        #toast {
            visibility: hidden;
            min-width: 200px;
            background-color: #d2d2d2;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 10px;
            position: fixed;
            z-index: 10;
            right: 20px;
            bottom: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.4s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>

<body>
    <h1 id="displayRes">e0.00 P</h1>
    <div class="tabs">
        <button class="tabBtn active" data-tab="tab1">Collect</button>
        <button class="tabBtn" data-tab="tab2">Dimension</button>
        <button class="tabBtn" data-tab="tab3">Synth</button>
        <button class="tabBtn" data-tab="tab4">Boost</button>
        <button class="tabBtn" data-tab="tab5">Save</button>
    </div>

    <div id="tab1" class="tab-content" style="display:block">
        <div class="card">
            <h3>Collect</h3>
            <button id="collectBtn">+1</button>
            <div class="row">
                <button id="buyCollector">Buy Collecter</button>
                <button id="buyCollectorMax">Buy Max</button>
                <span id="collectorInfo"></span>
            </div>
            <h4>Other Collecter</h4>
            <p>Buy any of these will clear collecters, planks and dimensions.</p>
            <div class="row"><button id="buyAtomCollector">Atom Collecter</button><span id="atomCollectorInfo"></span>
            </div>
        </div>
    </div>

    <div id="tab2" class="tab-content">
        <div class="card">
            <h3>Dimension</h3>
            <div class="row">
                <button id="buyDimension">Buy Dimension</button>
                <span id="dimensionInfo"></span>
            </div>
            <p>Collect Per Second = (Collecter * Boost) ^ Dimension * Copier</p>
            <p>Max Dimension: 11</p>
        </div>
    </div>

    <div id="tab3" class="tab-content">
        <div class="card">
            <h3>Synth</h3>
            <div class="row">
                <button id="synthUp">Synth UpQuark</button>
                <button id="synthUpMax">Synth Max</button>
                <span>Cost: e100 Plank | Have: <span id="upQuark">0</span></span>
            </div>
            <div class="row">
                <button id="synthDown">Synth DownQuark</button>
                <button id="synthDownMax">Synth Max</button>
                <span>Cost: e100 Plank | Have: <span id="downQuark">0</span></span>
            </div>
            <div class="row">
                <button id="synthProton">Synth Proton</button>
                <button id="synthProtonMax">Synth Max</button>
                <span>Cost: 2UpQuark + 1DownQuark | Have: <span id="proton">0</span></span>
            </div>
            <div class="row">
                <button id="synthAtom">Synth Atom</button>
                <button id="synthAtomMax">Synth Max</button>
                <span>Cost: 2Proton | Have: <span id="atom">0</span></span>
            </div>
            <div class="row"><span>Synth Loss: <span id="synthLoss">1/2</span></span></div>
        </div>
    </div>

    <div id="tab4" class="tab-content">
        <div class="card">
            <h3>Boost</h3>
            <div class="row">
                <button id="buyCollectBoost">Buy Collecting Boost</button>
                <button id="buyCollectBoostMax">Buy Max</button>
                <span>Times: <span id="collectBoost">1</span> | Cost: <span id="collectBoostCost">e1.00</span></span>
            </div>
            <div class="row">
                <button id="buyCopier">Buy Copier</button>
                <button id="buyCopierMax">Buy Max</button>
                <span>Copier: <span id="copier">1</span> | Cost: <span id="copierCost">e1.00</span></span>
            </div>
            <div class="row">
                <button id="buyDiscounter">Buy Discounter</button>
                <button id="buyDiscounterMax">Buy Max</button>
                <span>Discounter: <span id="discounter">1</span> | Cost: <span id="discounterCost">e1.00</span></span>
            </div>
            <div class="row">
                <button id="upgradeSynthLoss">Decrease Synth Loss</button>
                <button id="upgradeSynthLossMax">Buy Max</button>
                <span>Loss: <span id="synthLossUpgrade">1/2</span> | Cost: <span id="synthLossCost">e1.00</span></span>
            </div>
        </div>
    </div>

    <div id="tab5" class="tab-content">
        <div class="card">
            <h3>SAVE/IMPOER/EXPORT</h3>
            <button id="exportBtn">EXPORT TO TXT</button>
            <input type="file" id="importFile" style="display:none" accept=".txt">
            <button id="importBtn">IMPORT FROM TXT</button>
            <button id="resetBtn">RESET</button>
        </div>
    </div>
    <div id="toast">Tips</div>
    <script>
        function formatValue(x) { return x <= 0 ? '0' : 'e' + Math.log10(x).toFixed(2); }
        function showToast(msg) { let t = document.getElementById("toast"); t.textContent = msg; t.className = "show"; setTimeout(() => { t.className = ""; }, 2500); }
        let state = {
            planck: 0, collectors: 0, dimensions: 1,
            upQuark: 0, downQuark: 0, proton: 0, atom: 0,
            atomCollector: 0,
            collectBoost: 1, synthLoss: 2, copier: 0, discounter: 1, lastSave: Date.now(),
            bought: { atomCollector: false }
        };
        function collectorCost(level) { return (level > 1073741824 ? Infinity : 10 ** 50 * Math.pow(level, level / 1048576 / 3)) / state.discounter; }
        function boostCost(level) { return (Math.pow(10, level / 2.5)) / state.discounter; }
        function dimensionCost(level) { return (level > 11 ? Infinity : Math.pow(10, level ** 2 - (level >= 10))) / state.discounter; }
        function synthLossCost(level) { return (Math.pow(10, level * 2)) / state.discounter; }
        function copierCost(level) { return (Math.pow(level, level / 100.0)) / state.discounter; }
        function discounterCost(level) { return (Math.pow(level, level / 500.0)) / state.discounter; }
        function calcGain(collecter) { return Math.pow(collecter * state.collectBoost, state.dimensions) * state.copier; }
        function render() {
            document.getElementById('displayRes').textContent = formatValue(state.planck) + ' PLK ' + formatValue(state.atom) + ' Atom';
            document.getElementById('collectorInfo').textContent = `Collecter:${state.collectors} | Cost: ${formatValue(collectorCost(state.collectors + 1))}`;
            document.getElementById('dimensionInfo').textContent = `dimension:${state.dimensions} | Cost: ${formatValue(dimensionCost(state.dimensions + 1))}`;
            document.getElementById('upQuark').textContent = formatValue(state.upQuark);
            document.getElementById('downQuark').textContent = formatValue(state.downQuark);
            document.getElementById('proton').textContent = formatValue(state.proton);
            document.getElementById('atom').textContent = formatValue(state.atom);
            document.getElementById('atomCollectorInfo').textContent = `Have:${formatValue(state.atomCollector)} | Cost:e2 Atom`;
            document.getElementById('collectBoost').textContent = state.collectBoost;
            document.getElementById('collectBoostCost').textContent = formatValue(boostCost(state.collectBoost));
            document.getElementById('copier').textContent = state.copier;
            document.getElementById('copierCost').textContent = formatValue(copierCost(state.copier));
            document.getElementById('discounter').textContent = state.discounter;
            document.getElementById('discounterCost').textContent = formatValue(discounterCost(state.discounter));
            document.getElementById('synthLoss').textContent = `1/${state.synthLoss}`;
            document.getElementById('synthLossUpgrade').textContent = `1/${state.synthLoss}`;
            document.getElementById('synthLossCost').textContent = formatValue(synthLossCost(state.synthLoss + 1));
        }
        function saveToLocal(showMsg = false) {
            let now = Date.now();
            let delta = Math.floor((now - (state.lastSave || now)) / 1000);
            if (delta > 0) {
                let gainPlanck = delta * (calcGain(state.collectors));
                state.planck += gainPlanck;
                let gainProton = delta * (calcGain(state.protonCollector));
                state.proton += gainProton;
                let gainAtom = delta * (calcGain(state.atomCollector));
                state.atom += gainAtom;
                showToast(`OFFLINE Gained: P:${formatValue(gainPlanck)} Atom:${formatValue(gainAtom)}`);
            }
            state.lastSave = now;
            localStorage.setItem("CRLMOM_SAVE", JSON.stringify(state));
        }
        function loadFromLocal() {
            let saved = localStorage.getItem("CRLMOM_SAVE");
            if (saved) {
                state = JSON.parse(saved);
                if (state.copier == undefined) {
                    state.copier = 0;
                }
                if (state.discounter == undefined) {
                    state.discounter = 1;
                }
            }
            saveToLocal(false);
        }
        loadFromLocal();
        render();

        document.querySelectorAll('.tabBtn').forEach(btn => { btn.addEventListener('click', () => { document.querySelectorAll('.tabBtn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none'); document.getElementById(btn.dataset.tab).style.display = 'block'; }); });

        document.getElementById('collectBtn').onclick = () => { state.planck += state.collectBoost; render(); }
        document.getElementById('buyCollector').onclick = () => { let cost = collectorCost(state.collectors + 1); if (state.planck >= cost) { state.planck -= cost; state.collectors++; render(); } }
        document.getElementById('buyCollectorMax').onclick = () => { if (collectorCost(state.collectors + 1) == Infinity) return; while (state.planck >= collectorCost(state.collectors + 1)) { state.planck -= collectorCost(state.collectors + 1); state.collectors++; } render(); }

        function buyMaterialCollector(type, res) { if (!state.bought[type] && state[res] >= 10 ** 2) { state[res] -= 10 ** 2; state[type]++; state.bought[type] = true; state.planck = 0; state.dimensions = 1; state.collectBoost = 1; render(); } }
        document.getElementById('buyAtomCollector').onclick = () => buyMaterialCollector('atomCollector', 'atom');

        document.getElementById('buyDimension').onclick = () => { let cost = dimensionCost(state.dimensions + 1); if (state.planck >= cost) { state.planck -= cost; state.dimensions++; render(); } }

        document.getElementById('buyCollectBoost').onclick = () => { let cost = boostCost(state.collectBoost); if (state.planck >= cost) { state.planck -= cost; state.collectBoost++; render(); } }
        document.getElementById('buyCollectBoostMax').onclick = () => { while (state.planck >= boostCost(state.collectBoost)) { state.planck -= boostCost(state.collectBoost); state.collectBoost++; } render(); }

        document.getElementById('buyCopier').onclick = () => { let cost = copierCost(state.copier); if (state.planck >= cost) { state.planck -= cost; state.copier++; render(); } }
        document.getElementById('buyCopierMax').onclick = () => { while (state.planck >= copierCost(state.copier)) { state.planck -= copierCost(state.copier); state.copier++; } render(); }

        document.getElementById('buyDiscounter').onclick = () => { let cost = discounterCost(state.discounter); if (state.planck >= cost) { state.planck -= cost; state.discounter++; render(); } }
        document.getElementById('buyDiscounterMax').onclick = () => { while (state.planck >= discounterCost(state.discounter)) { state.planck -= discounterCost(state.discounter); state.discounter++; } render(); }

        document.getElementById('upgradeSynthLoss').onclick = () => { let cost = synthLossCost(state.synthLoss + 1); if (state.planck >= cost) { state.planck -= cost; state.synthLoss++; render(); } }
        document.getElementById('upgradeSynthLossMax').onclick = () => {
            while (state.planck >= synthLossCost(state.synthLoss + 1)) { state.planck -= synthLossCost(state.synthLoss + 1); state.synthLoss++; render(); }
        }

        function synth(resource, amount) {
            let loss = 1 / state.synthLoss;
            function deduct(v) { return Math.max(Math.floor(v * (1 - loss)), 0); }
            if (resource == 'upQuark' || resource == 'downQuark') { if (state.planck >= 1e100) { state.planck -= 1e100; state[resource] += amount; render(); } }
            else if (resource == 'proton') { if (state.upQuark >= 2 && state.downQuark >= 1) { state.upQuark = deduct(state.upQuark - 2); state.downQuark = deduct(state.downQuark - 1); state.proton += amount; render(); } }
            else if (resource == 'atom') { if (state.proton >= 2) { state.proton = deduct(state.proton - 2); state.atom += amount; render(); } }
        }

        document.getElementById('synthUp').onclick = () => synth('upQuark', 1);
        document.getElementById('synthUpMax').onclick = () => { while (state.planck >= 1e100) synth('upQuark', 1); }
        document.getElementById('synthDown').onclick = () => synth('downQuark', 1);
        document.getElementById('synthDownMax').onclick = () => { while (state.planck >= 1e100) synth('downQuark', 1); }
        document.getElementById('synthProton').onclick = () => synth('proton', 1);
        document.getElementById('synthProtonMax').onclick = () => { while (state.upQuark >= 2 && state.downQuark >= 1) synth('proton', 1); }
        document.getElementById('synthAtom').onclick = () => synth('atom', 1);
        document.getElementById('synthAtomMax').onclick = () => { while (state.proton >= 2) synth('atom', 1); }

        document.getElementById('exportBtn').onclick = () => {
            let data = "data:text/plain;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            let a = document.createElement('a'); a.href = data; a.download = 'CRLMOM_save.txt'; a.click();
        }
        document.getElementById('importBtn').onclick = () => document.getElementById('importFile').click();
        document.getElementById('importFile').onchange = function (e) {
            let file = e.target.files[0]; if (!file) return;
            let reader = new FileReader();
            reader.onload = function () { state = JSON.parse(reader.result); loadFromLocal(); render(); }
            reader.readAsText(file);
        }

        document.getElementById('resetBtn').onclick = () => {
            if (confirm('Really reset?')) { localStorage.removeItem('CRLMOM_SAVE'); location.reload(); loadFromLocal(); }
        }

        setInterval(() => {
            let gainPlanck = (calcGain(state.collectors));
            state.planck += gainPlanck;
            let gainProton = (calcGain(state.protonCollector));
            state.proton += gainProton;
            let gainAtom = (calcGain(state.atomCollector));
            state.atom += gainAtom;
            render();
        }, 1000);

        setInterval(() => { saveToLocal(); }, 3000);
        render();
    </script>
</body>

</html>